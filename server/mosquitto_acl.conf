# Mosquitto ACL (Access Control List)
# Access control for OTA MQTT topics

# ==================== Topic Patterns ====================

# OEM Server (Full Access)
user oem_server
topic readwrite oem/#
topic readwrite $SYS/#

# VMG Clients (Vehicle Master Gateway)
# Each vehicle should have its own user: vmg_VIN123, vmg_VIN456, etc.

# Pattern for VMG users
# Replace {vin} with actual VIN

pattern read oem/%u/command
pattern read oem/%u/ota/campaign
pattern read oem/%u/ota/metadata

pattern write oem/%u/wake_up
pattern write oem/%u/response
pattern write oem/%u/vci
pattern write oem/%u/telemetry
pattern write oem/%u/ota/status

# ==================== Example Users ====================

# VMG for vehicle VIN123
user vmg_VIN123
topic read oem/VIN123/command
topic read oem/VIN123/ota/campaign
topic read oem/VIN123/ota/metadata
topic write oem/VIN123/wake_up
topic write oem/VIN123/response
topic write oem/VIN123/vci
topic write oem/VIN123/telemetry
topic write oem/VIN123/ota/status

# VMG for vehicle VIN456
user vmg_VIN456
topic read oem/VIN456/command
topic read oem/VIN456/ota/campaign
topic read oem/VIN456/ota/metadata
topic write oem/VIN456/wake_up
topic write oem/VIN456/response
topic write oem/VIN456/vci
topic write oem/VIN456/telemetry
topic write oem/VIN456/ota/status

# ==================== System Topics ====================

# Deny all users from accessing system topics by default
# Only oem_server can access $SYS/#

# ==================== Notes ====================

# To create password file:
# mosquitto_passwd -c /etc/mosquitto/passwd oem_server
# mosquitto_passwd -b /etc/mosquitto/passwd vmg_VIN123 password123

